<!DOCTYPE html>
<html>
<head>
	<title>Beschleunigungssensor-Überwachung</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		body {
			background-color: red;
		}
		.shaken {
			background-color: green;
		}
	</style>
</head>
<body>
	<button onclick="startMonitoring()">Überwachung starten</button>
	<div id="acceleration-value"></div>
	
	<script>
		function startMonitoring() {
			if (typeof DeviceMotionEvent.requestPermission === 'function') {
				// Zustimmung des Benutzers einholen, um auf Beschleunigungssensoren zuzugreifen
				DeviceMotionEvent.requestPermission().then(response => {
					if (response == 'granted') {
						// Ereignislistener hinzufügen, um Bewegungen des Geräts zu überwachen
						window.addEventListener('devicemotion', handleMotionEvent);
					}
				}).catch(console.error);
			} else {
				// Das Gerät unterstützt keine Zustimmungserklärung, daher einfach Ereignislistener hinzufügen
				window.addEventListener('devicemotion', handleMotionEvent);
			}
		}

		function handleMotionEvent(event) {
			// Schwellenwert für Bewegungserkennung festlegen
			const threshold = 10;
			const accelerationValues = [];

			// Beschleunigungsdaten des Geräts aus dem Event-Objekt abrufen
			const { z } = event.accelerationIncludingGravity;

			// Berechnen Sie die Gesamtbeschleunigung des Geräts
			const acceleration = Math.abs(z);

			// Fügen Sie den aktuellen Beschleunigungswert zur Beschleunigungswertliste hinzu
			accelerationValues.push(acceleration);

			// Entfernen Sie alle Werte aus der Beschleunigungswertliste, die älter als eine Sekunde sind
			const currentTime = new Date().getTime();
			while (accelerationValues.length > 0 && (currentTime - accelerationValues[0].timestamp) > 1000) {
				accelerationValues.shift();
			}

			// Berechnen Sie den durchschnittlichen Beschleunigungswert der letzten Sekunde
			const averageAcceleration = accelerationValues.reduce((acc, cur) => acc + cur.value, 0) / accelerationValues.length;

			// Geben Sie den durchschnittlichen Beschleunigungswert auf der Website aus
			const accelerationValueDiv = document.getElementById('acceleration-value');
			accelerationValueDiv.innerHTML = `Durchschnittliche Beschleunigung: ${averageAcceleration}`;

			// Überprüfen Sie, ob das Gerät geschüttelt wird
			if (averageAcceleration > threshold) {
				// Das Gerät wird geschüttelt, fügen Sie hier den Code ein, den Sie ausführen möchten.
				console.log('Gerät wird geschüttelt!');
				document.body.classList.add('shaken');
			} else {
				document.body.classList.remove('shaken');
			}
		}
	</script>
</body>
</html>
