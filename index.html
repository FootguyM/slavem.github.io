<!DOCTYPE html>
<html>
<head>
	<title>Beschleunigungssensor-Überwachung</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		body {
			background-color: red;
		}
		.green {
			background-color: green;
		}
	</style>
</head>
<body>
	<button onclick="startMonitoring()">Überwachung starten</button>
	<p id="acceleration"></p>

	<script>
		let accelerationArray = [];
		let averageAcceleration = 0;
		let isShaken = false;

		function startMonitoring() {
			if (typeof DeviceMotionEvent.requestPermission === 'function') {
				DeviceMotionEvent.requestPermission().then(response => {
					if (response == 'granted') {
						window.addEventListener('devicemotion', handleMotionEvent);
					}
				}).catch(console.error);
			} else {
				window.addEventListener('devicemotion', handleMotionEvent);
			}
			setInterval(updateAcceleration, 1000);
		}

		function handleMotionEvent(event) {
			const threshold = 10;
			const { x, y, z } = event.accelerationIncludingGravity;
			const acceleration = Math.sqrt(x * x + y * y + z * z);

			if (acceleration > threshold) {
				isShaken = true;
			}
			accelerationArray.push(acceleration);
		}

		function updateAcceleration() {
			if (accelerationArray.length > 0) {
				const sum = accelerationArray.reduce((acc, val) => acc + val, 0);
				averageAcceleration = sum / accelerationArray.length;
				accelerationArray = [];
			} else {
				averageAcceleration = 0;
				isShaken = false;
			}

			const accelerationText = `Durchschnittliche Beschleunigung: ${averageAcceleration.toFixed(2)} m/s^2`;
			document.getElementById("acceleration").innerHTML = accelerationText;

			if (isShaken) {
				document.body.classList.add("green");
			} else {
				document.body.classList.remove("green");
			}
		}
	</script>
</body>
</html>
